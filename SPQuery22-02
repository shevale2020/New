Declare @PONumber NVARCHAR(250) = 'Assign value here'
	Declare @GRNNumber VARCHAR(max) = 'Assign value here'	
  	DECLARE @QTY INT;
    
		SELECT @QTY = (
				SELECT sum(((cast(CAST(LTRIM(RTRIM(QUANTITY)) AS DECIMAL) AS BIGINT)))) AS QUANTITY
				FROM (
					SELECT DISTINCT t1.*
					FROM [WNS_RCV_TRANSACTIONS] t1
					INNER JOIN [WNS_ITEM_MSTER_V] t2 ON t1.ItemCode = t2.ItemCode
					WHERE t1.PONumber = @PONumber
						AND t1.GRNNumber IN (
							SELECT List AS GRNNumberList
							FROM uft_Split(@GRNNumber, ',')
							)
						--and t2.ITEM_STATUS='Active' 
						AND t2.ASSET_TYPE = 'IT'
						AND t2.TAG_TYPE = 'Taggable'
					) AS tem1
				)

		DECLARE @TagQTY INT;

		SELECT @TagQTY = (
				SELECT count(*)
				FROM TD_TAG t1
				INNER JOIN TD_TAGMaster t2 ON t1.TAGMasterId = t2.TAGMasterId
				WHERE t2.PONumber = @PONumber
					AND t2.GRNNumber IN (
						SELECT List AS GRNNumberList
						FROM uft_Split(@GRNNumber, ',')
						)
				)

		DECLARE @ActualInsertTagQTY INT;

		SELECT @ActualInsertTagQTY = (
				SELECT count(*)
				FROM TD_InventoryCommonDetail t1
				INNER JOIN TD_Inventory t2 ON t1.InventoryId = t2.InventoryId
				WHERE t2.PONumber = @PONumber
					AND t2.GRNNumber IN (
						SELECT List AS GRNNumberList
						FROM uft_Split(@GRNNumber, ',')
						)
					AND t1.ToDate IS NULL
					AND t1.IsAssetValidationRequired = 1
				)

  
  SELECT t1.TAGNumber
							,t2.GRNNumber
							,t2.ItemCode
						FROM TD_TAG t1
						INNER JOIN TD_TAGMaster t2 ON t1.TAGMasterId = t2.TAGMasterId
						WHERE t2.PONumber = @PONumber
							AND t2.GRNNumber IN (
								SELECT List AS GRNNumberList
								FROM uft_Split(@GRNNumber, ',')
								)
							AND t1.TAGNumber NOT IN (
								SELECT t1.TAGNumber
								FROM TD_InventoryCommonDetail t1
								INNER JOIN TD_Inventory t2 ON t1.InventoryId = t2.InventoryId
								WHERE t2.PONumber = @PONumber
									AND t2.GRNNumber IN (
										SELECT List AS GRNNumberList
										FROM uft_Split(@GRNNumber, ',')
										)
									AND t1.ToDate IS NULL
									AND t1.IsAssetValidationRequired = 1
								)
                
                
                select @QTY as  Qty, @TagQTY as TagQTY , @ActualInsertTagQTY as ActualInsertTagQTY
