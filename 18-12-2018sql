

----------------------------------------------------------  Network--------------------------------------------------------------------------------------------------------------------------------------------------------------------------
DECLARE @dntw TABLE (PONumber NVARCHAR(100), GRNNumber NVARCHAR(100),  ASSET_TYPE NVARCHAR(50), TAG_COUNT NVARCHAR(50), TAG_TYPE NVARCHAR(50), EXP_TYPE NVARCHAR(50), MAJOR_CATEGORY NVARCHAR(500),MINOR_CATEGORY NVARCHAR(500),      
SubMinorCategory NVARCHAR(500), Location NVARCHAR(max),     INV_TYPE NVARCHAR(50),     QUANTITY NVARCHAR(50),       ItemCode NVARCHAR(50),    
 AssetTypeNetworkDrp NVARCHAR(MAX), MakeNetworkDrp NVARCHAR(MAX),SharedDedicatedNwDrp NVARCHAR(MAX),StockstatusNwDrp NVARCHAR(MAX), DeviceSupportNwDrp NVARCHAR(MAX),EndoflifeofdeviceNwDrp NVARCHAR(MAX),ModelSizeNetworkDrp NVARCHAR(MAX), Po_line_id NVARCHAR(50),   VendorName NVARCHAR(MAX),   PODate NVARCHAR(50), GRNDate NVARCHAR(50), SubMinCategory NVARCHAR(MAX),Repeat  INT,DateOfAcquisition date,TAGNumber NVARCHAR(100));


DECLARE @dntw1 TABLE (PONumber NVARCHAR(100), GRNNumber NVARCHAR(100),  ASSET_TYPE NVARCHAR(50), TAG_COUNT NVARCHAR(50), TAG_TYPE NVARCHAR(50), EXP_TYPE NVARCHAR(50), MAJOR_CATEGORY NVARCHAR(500),MINOR_CATEGORY NVARCHAR(500),      
SubMinorCategory NVARCHAR(500), Location NVARCHAR(max),     INV_TYPE NVARCHAR(50),     QUANTITY NVARCHAR(50),       ItemCode NVARCHAR(50),    
 AssetTypeNetworkDrp NVARCHAR(MAX), MakeNetworkDrp NVARCHAR(MAX),SharedDedicatedNwDrp NVARCHAR(MAX),StockstatusNwDrp NVARCHAR(MAX), DeviceSupportNwDrp NVARCHAR(MAX),EndoflifeofdeviceNwDrp NVARCHAR(MAX),ModelSizeNetworkDrp NVARCHAR(MAX), Po_line_id NVARCHAR(50),   VendorName NVARCHAR(MAX),   PODate NVARCHAR(50), GRNDate NVARCHAR(50), SubMinCategory NVARCHAR(MAX),Repeat  INT,DateOfAcquisition date,TAGNumber NVARCHAR(100) );



  	  


Declare @Qty int =( select top(1) ((cast( CAST(LTRIM(RTRIM(b.QUANTITY)) as decimal) as bigint )) ) as QUANTITY
from WNS_PO_DETAILS_V(nolock) a inner join WNS_RCV_TRANSACTIONS(nolock) b
 on a.PONumber=b.PONumber and a.ItemCode=b.ItemCode AND  a.LineNum=b.PO_LINE_NUM
 inner join WNS_ITEM_MSTER_V (nolock)c on c.ItemCode=a.ItemCode and c.INVENTORY_ORG=a.INVENTORY_ORG
 where 
-- a.PONumber= '3640000145' and GRNNumber='5640000462'
a.PONumber=@PONumber  and (@GRNNumber  is null or @GRNNumber ='' or GRNNumber=@GRNNumber )
 and INV_TYPE='Network'
 and b.QUANTITY is not null)


 INSERT @dntw
select * from (
( select --distinct --top 1 
  a.PONumber ,  b.GRNNumber
   , isnull(c.ASSET_TYPE,'IT') as ASSET_TYPE,c.TAG_COUNT,c.TAG_TYPE,c.EXP_TYPE,c.MAJOR_CATEGORY,c.MINOR_CATEGORY
, '' as SubMinorCategory, c.INVENTORY_ORG as Location,c.INV_TYPE,((cast( CAST(LTRIM(RTRIM(b.QUANTITY)) as decimal) as bigint )) ) as QUANTITY
,a.ItemCode
,'' as AssetTypeNetworkDrp -- need to add dropdown at top from master
,'<option value=''''> </option>'+@MakeNetwork as  MakeNetworkDrp-- need to add dropdown at top from master
 ,'<option value=''''> </option>'+@SharedDedicatedNetwork as SharedDedicatedNwDrp-- need to add dropdown at top from master
 ,'<option value=''''> </option>'+@StockStausNetwork as StockstatusNwDrp-- need to add dropdown at top from master
,'<option value=''''> </option>'+@DeviceSupportNetwork as DeviceSupportNwDrp-- need to add dropdown at top from master
,'<option value=''''> </option>'+@EndoflifeofdeviceNetwork as EndoflifeofdeviceNwDrp-- need to add dropdown at top from master
, '' as ModelSizeNetworkDrp --need to add dropdown at top from master 
  ,'' as Po_line_id
--,a.LineDescription
,a.VendorName
,a.POCreationDate as PODate
,b.GRNDate
, '<option value=''''> </option>'+@SubMinorCategory as SubMinCategory
,(c.TAG_COUNT * ((cast( CAST(LTRIM(RTRIM(b.QUANTITY)) as decimal) as bigint )) )) as Repeatmm ,

convert(date,v.DateOfAcquisition)  as DateOfAcquisition
 from WNS_PO_DETAILS_V(nolock) a inner join WNS_RCV_TRANSACTIONS(nolock) b
 on a.PONumber=b.PONumber and a.ItemCode=b.ItemCode AND  a.LineNum=b.PO_LINE_NUM
 inner join WNS_ITEM_MSTER_V (nolock)c on c.ItemCode=a.ItemCode and c.INVENTORY_ORG=a.INVENTORY_ORG

inner join   WNS_ASSET_DETAILS_V  as v on v.PONumber=a.PONumber  
 where 
-- a.PONumber= '3640000145' and GRNNumber='5640000462'
a.PONumber=@PONumber  and (@GRNNumber  is null or @GRNNumber ='' or GRNNumber=@GRNNumber )
 and INV_TYPE='Network'
 and b.QUANTITY is not null) temp 1 
  

cross apply 
(
Select  top( @Qty )t1.TAGNumber
from TD_TAG t1
inner join TD_TAGMaster t2 on t1.TAGMasterId=t2.TAGMasterId
where PONumber=@PONumber and GRNNumber=@GRNNumber
Except
Select t1.TAGNumber
from TD_InventoryCommonDetail t1
inner join TD_Inventory t2 on t1.InventoryId=t2.InventoryId
where PONumber=@GRNNumber and GRNNumber=@GRNNumber
) as temp2

) 
