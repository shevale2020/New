SELECT temp1.*,temp2.TAGNumber
FROM (
	(
		SELECT a.PONumber
			,b.GRNNumber
			,isnull(c.ASSET_TYPE, 'IT') AS ASSET_TYPE
			,c.TAG_COUNT
			,c.TAG_TYPE
			,c.EXP_TYPE
			,c.MAJOR_CATEGORY
			,c.MINOR_CATEGORY
			,'' AS SubMinorCategory
			,c.INVENTORY_ORG AS Location
			,c.INV_TYPE
			,((cast(CAST(LTRIM(RTRIM(b.QUANTITY)) AS DECIMAL) AS BIGINT))) AS QUANTITY
			,a.ItemCode
			,'' AS AssetTypeNetworkDrp -- need to add dropdown at top from master
			,'<option value=''''> </option>' + @MakeNetwork AS MakeNetworkDrp -- need to add dropdown at top from master
			,'<option value=''''> </option>' + @SharedDedicatedNetwork AS SharedDedicatedNwDrp -- need to add dropdown at top from master
			,'<option value=''''> </option>' + @StockStausNetwork AS StockstatusNwDrp -- need to add dropdown at top from master
			,'<option value=''''> </option>' + @DeviceSupportNetwork AS DeviceSupportNwDrp -- need to add dropdown at top from master
			,'<option value=''''> </option>' + @EndoflifeofdeviceNetwork AS EndoflifeofdeviceNwDrp -- need to add dropdown at top from master
			,'' AS ModelSizeNetworkDrp --need to add dropdown at top from master 
			,'' AS Po_line_id
			--,a.LineDescription
			,a.VendorName
			,a.POCreationDate AS PODate
			,b.GRNDate
			,'<option value=''''> </option>' + @SubMinorCategory AS SubMinCategory
			,d.DateOfAcquisition
			,(c.TAG_COUNT * ((cast(CAST(LTRIM(RTRIM(b.QUANTITY)) AS DECIMAL) AS BIGINT)))) AS Repeat
		FROM WNS_PO_DETAILS_V(NOLOCK) a
		INNER JOIN WNS_RCV_TRANSACTIONS(NOLOCK) b ON a.PONumber = b.PONumber
			AND a.ItemCode = b.ItemCode
			AND a.LineNum = b.PO_LINE_NUM
		INNER JOIN WNS_ITEM_MSTER_V(NOLOCK) c ON c.ItemCode = a.ItemCode
			AND c.INVENTORY_ORG = a.INVENTORY_ORG
		INNER JOIN WNS_ASSET_DETAILS_V(NOLOCK) d ON d.PONumber = a.PONumber
		LEFT JOIN @Nw e ON e.ItemCode = b.ItemCode
		WHERE
			-- a.PONumber= '3640000145' and GRNNumber='5640000462'
			a.PONumber = @PONumber
			AND (
				@GRNNumber IS NULL
				OR @GRNNumber = ''
				OR b.GRNNumber IN (
					SELECT List AS GRNNumberList
					FROM uft_Split(@GRNNumber, ',')
					)
				)
			AND INV_TYPE = 'Network'
			AND b.QUANTITY IS NOT NULL
		GROUP BY a.PONumber
			,b.GRNNumber
			,isnull(c.ASSET_TYPE, 'IT')
			,c.TAG_COUNT
			,c.TAG_TYPE
			,c.EXP_TYPE
			,c.MAJOR_CATEGORY
			,c.MINOR_CATEGORY
			,c.INVENTORY_ORG
			,c.INV_TYPE
			,((cast(CAST(LTRIM(RTRIM(b.QUANTITY)) AS DECIMAL) AS BIGINT)))
			,a.ItemCode
			,a.VendorName
			,a.POCreationDate
			,b.GRNDate
			,d.DateOfAcquisition
		) AS temp1 
		
		inner join  (

			SELECT  t1.TAGNumber,t2.GRNNumber
			FROM TD_TAG t1
			INNER JOIN TD_TAGMaster t2 ON t1.TAGMasterId = t2.TAGMasterId
			WHERE t2.PONumber = @PONumber
				AND t2.GRNNumber IN (
					SELECT List AS GRNNumberList
					FROM uft_Split(@GRNNumber, ',')
					)
			   and t1.TAGNumber not in (
					SELECT t1.TAGNumber
					FROM TD_InventoryCommonDetail t1
					INNER JOIN TD_Inventory t2 ON t1.InventoryId = t2.InventoryId
					WHERE t2.PONumber = @PONumber
						AND t2.GRNNumber IN (
							SELECT List AS GRNNumberList
							FROM uft_Split(@GRNNumber, ',')
							)
						AND t1.ToDate IS NULL
						AND t1.IsAssetValidationRequired = 1)
	
		) AS temp2
		
		 on temp1.GRNNumber=temp2.GRNNumber
	)
